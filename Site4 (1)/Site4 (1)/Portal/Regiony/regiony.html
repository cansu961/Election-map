<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–†–ï–ì–ò–û–ù–´</title>
<link rel="stylesheet" href="../CSS/portal.css">
</head>
<body class="theme-current">
<div class="wrapper">
    <header class="header">
        <div class="header-left">
            <a href="https://google.com" class="header-btn">–°–æ–≤–µ—Ç –§–µ–¥–µ—Ä–∞—Ü–∏–∏</a>
            <a href="https://google.com" class="header-btn">–ò–ê–£</a>
            <a href="../index.html" class="header-btn">–ù–∞–∑–∞–¥</a>
            <span class="header-title">–†–ï–ì–ò–û–ù–´</span>
        </div>
        <div class="header-right">
            <button class="header-btn" id="emailBtn" onclick="emailPage()" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ email" style="display:inline-flex;align-items:center;gap:6px;">
                <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="4" width="20" height="16" rx="2"/><polyline points="2,4 12,13 22,4"/></svg>
                –û—Ç–ø—Ä–∞–≤–∏—Ç—å
            </button>
            <button class="header-btn" id="printBtn" onclick="printPage()" title="–ü–µ—á–∞—Ç—å" style="display:inline-flex;align-items:center;gap:6px;">
                <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
                –ü–µ—á–∞—Ç—å
            </button>
            <div class="theme-switcher">
                <button class="theme-toggle-btn" id="themeToggle">&#9682; –¢–ï–ú–´</button>
                <div class="theme-dropdown" id="themeDropdown">
                    <button class="theme-option is-active" data-theme="theme-current"><span class="swatch sw-current"></span>–ú—è—Ç–Ω–∞—è</button>
                    <button class="theme-option" data-theme="theme-mint"><span class="swatch sw-mint"></span>–ö–æ–±–∞–ª—å—Ç</button>
                    <button class="theme-option" data-theme="theme-glass"><span class="swatch sw-glass"></span>–ì—Ä–∞—Ñ–∏—Ç</button>
                </div>
            </div>
        </div>
    </header>
    <main class="content-inner">
        <div class="inner-icon">üó∫</div>
        <div>–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</div>
    </main>
</div>
<footer class="footer">&copy;&nbsp;<span id="year"></span>&nbsp;&nbsp;–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ-–∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</footer>

<script src="../JS/theme.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" async></script>

<script>
function printPage() {
    window.print();
}

function emailPage() {
    var btn = document.getElementById('emailBtn');
    var origHTML = btn.innerHTML;
    btn.innerHTML = '\u23f3 ...';
    btn.disabled = true;

    var pageTitle = '–†–ï–ì–ò–û–ù–´';
    var now = new Date();
    var dateStr = now.toLocaleDateString('ru-RU', {day:'2-digit', month:'2-digit', year:'numeric'})
                + ' ' + now.toLocaleTimeString('ru-RU', {hour:'2-digit', minute:'2-digit'});
    var subject = pageTitle + ' \u2014 ' + dateStr;

    var wrap = document.createElement('div');
    wrap.style.cssText = 'position:fixed;left:-9999px;top:0;width:794px;background:#fff;' +
                         'font-family:Arial Narrow,Arial,sans-serif;color:#1a1a1a;z-index:-1;overflow:hidden;';
    wrap.innerHTML =
        '<div style="width:750px;margin:0 auto;padding:30px 0 20px;">' +
        '<div style="font-size:15pt;font-weight:700;color:#1547A1;margin-bottom:4px;">' + pageTitle + '</div>' +
        '<div style="border-top:2px solid #1565C0;margin:8px 0 20px;"></div>' +
        '<div style="font-size:13pt;color:#555;text-align:center;padding:40px 0;">\u0420\u0430\u0437\u0434\u0435\u043b \u0432 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0435</div>' +
        '<div style="border-top:1px solid #ddd;padding-top:6px;margin-top:20px;font-size:8px;color:#aaa;">' +
        '\u0421\u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u043e: ' + dateStr +
        ' \u00a0\u00b7\u00a0 \u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u043e\u043d\u043d\u043e-\u0430\u043d\u0430\u043b\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435' +
        '</div></div>';

    document.body.appendChild(wrap);

    setTimeout(function() {
        html2canvas(wrap, {
            scale: 1.5, backgroundColor: '#ffffff', useCORS: true, logging: false,
            width: 794, windowWidth: 794
        }).then(function(canvas) {
            document.body.removeChild(wrap);
            var imgData = canvas.toDataURL('image/jpeg', 0.92);

            function makePdf() {
                var jsPDF = window.jspdf ? window.jspdf.jsPDF : null;
                if (!jsPDF) { setTimeout(makePdf, 150); return; }
                var doc = new jsPDF({orientation: 'portrait', unit: 'mm', format: 'a4'});
                var pdfH = Math.round(297 * canvas.height / canvas.width);
                if (pdfH > 297) pdfH = 297;
                doc.addImage(imgData, 'JPEG', 0, 0, 210, pdfH);
                var fname = 'regiony_' + now.getFullYear() +
                            String(now.getMonth()+1).padStart(2,'0') + '.pdf';
                doc.save(fname);

                var bodyTxt = encodeURIComponent(
                    '\u0423\u0432\u0430\u0436\u0430\u0435\u043c\u044b\u0435 \u043a\u043e\u043b\u043b\u0435\u0433\u0438,\r\n\r\n' +
                    '\u041d\u0430\u043f\u0440\u0430\u0432\u043b\u044f\u044e \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u044b \u0440\u0430\u0437\u0434\u0435\u043b\u0430 \u00ab' +
                    pageTitle + '\u00bb.\r\n\r\n' +
                    '\u0424\u0430\u0439\u043b \u0441\u043e\u0445\u0440\u0430\u043d\u0451\u043d: ' + fname + '\r\n' +
                    '\u041f\u0440\u0438\u043a\u0440\u0435\u043f\u0438\u0442\u0435 \u0435\u0433\u043e \u043a \u043f\u0438\u0441\u044c\u043c\u0443 \u043f\u0435\u0440\u0435\u0434 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u043e\u0439.\r\n\r\n' +
                    '\u0421 \u0443\u0432\u0430\u0436\u0435\u043d\u0438\u0435\u043c,\r\n\u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u043e\u043d\u043d\u043e-\u0430\u043d\u0430\u043b\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435'
                );
                window.location.href = 'mailto:?subject=' + encodeURIComponent(subject) + '&body=' + bodyTxt;
                btn.innerHTML = origHTML;
                btn.disabled = false;
            }
            makePdf();

        }).catch(function(err) {
            document.body.removeChild(wrap);
            alert('\u041e\u0448\u0438\u0431\u043a\u0430: ' + err.message);
            btn.innerHTML = origHTML;
            btn.disabled = false;
        });
    }, 200);
}
</script>
</body>
</html>
