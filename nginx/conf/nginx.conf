worker_processes  1;
events { worker_connections 256; }

http {
    include       mime.types;
    default_type  application/octet-stream;
    charset       utf-8;

    # JSON MIME type
    types { application/json json; }

    # Gzip compression
    gzip            on;
    gzip_types      text/plain text/css application/javascript application/json text/xml application/xml;
    gzip_min_length 1024;
    gzip_comp_level 6;
    gzip_vary       on;

    access_log  logs/access.log;
    error_log   logs/error.log;
    sendfile    on;

    server {
        listen       80;
        server_name  localhost;
        root         html/Portal;
        index        index.html;

        add_header Access-Control-Allow-Origin *;

        location / {
            try_files $uri $uri/ =404;
        }

        # JSON — кэш 10 минут
        location ~* \.json$ {
            expires 10m;
            add_header Cache-Control "public, no-transform";
            add_header Content-Type "application/json; charset=utf-8";
        }

        # CSS + JS — кэш 1 день
        location ~* \.(css|js)$ {
            expires 1d;
            add_header Cache-Control "public, no-transform";
        }

        # HTML — без кэша
        location ~* \.html$ {
            expires -1;
            add_header Cache-Control "no-cache, no-store, must-revalidate";
        }

        # Excel — без кэша
        location ~* \.xlsx$ {
            expires -1;
            add_header Cache-Control "no-cache, no-store";
        }

        error_page 404 /index.html;
    }
}
